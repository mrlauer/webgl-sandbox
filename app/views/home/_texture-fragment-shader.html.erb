<% shaderName ||= "shader-fs" %>
<script id="<%= shaderName %>" type="x-shader/x-fragment">
    #ifdef GL_ES
    precision highp float;
    #endif

    varying vec4 vPosition;
    varying vec2 vUV;
    uniform sampler2D uTextureLow;
    uniform sampler2D uTextureHigh;

    uniform float uMaxLimit;
    uniform float uMax;
    uniform float uMin;
    uniform float uMaxThreshold;
    uniform float uMinThreshold;
 
    void main(void) {
        float alpha = 1.0;
        vec3 low = texture2D(uTextureLow, vUV).rgb;
        vec3 high = texture2D(uTextureHigh, vUV).rgb;
        vec3 light = (low * 255.0 + high * (255.0 * 256.0) ) / uMaxLimit;

        const float eps=0.001;
        if(light.r < uMinThreshold-eps || light.r > uMaxThreshold+eps) {
            alpha = 0.0;
        }

        vec3 minrange = vec3(uMin, uMin, uMin);
        vec3 maxrange = vec3(uMax, uMax, uMax);
        vec3 fac = maxrange - minrange;
        light = (light - minrange) / fac;
 
        gl_FragColor = vec4(light, alpha);
    }
</script>

